"use strict";function createBaseElement(t,e){const a=document.createElement("div");return a.classList.add("td",`td_${t}`),a.style.width=`${e.width}px`,a.style.height=`${e.height}px`,a.style.left=`${e.x}px`,a.style.top=`${e.y}px`,a.style.position="absolute",a.type=t,a.opts=e,a}class TD{static update(t){const e=document.getElementsByClassName("td");for(let a=0;a<e.length;a++){const s=e[a];s.opts.name&&s.setValue&&void 0!==t[s.opts.name]&&s.setValue(t[s.opts.name])}}static label(t){return createLabelElement(t)}static button(t){return createButtonElement(t)}static toggle(t){return createToggleElement(t)}static value(t){return createValueElement(t)}static gauge(t){return createGaugeElement(t)}static pointer_gauge(t){return createPointerGaugeElement(t)}static graph(t){return createGraphElement(t)}static log(t){return createLogElement(t)}static modal(t){return createModalElement(t)}}const API_BASE_URL="/tinydash";async function fetchData(t){try{const e=await fetch(`/tinydash/${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(t){return console.error("Error fetching data:",t),null}}async function sendCommand(t,e,a){try{const s=await fetch(`/tinydash/${t}`,{method:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(a).toString()});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(t){return console.error("Error sending command:",t),null}}function sendChanges(t,e){if(t.opts.name){const a={};a[t.opts.name]=e,handleChange(a)}t.opts.onchange&&t.opts.onchange(t,e)}function togglePressed(t){if(t.pressed=!t.pressed,"toggle"===t.type){t.getElementsByClassName("td_toggle")[0].setAttribute("pressed",t.pressed?"1":"0")}else t.setAttribute("pressed",t.pressed?"1":"0");sendChanges(t,t.pressed),t.toggle||(t.pressed=!1,setTimeout(function(){t.setAttribute("pressed","0")},200))}function formatText(t){return"number"!=typeof t?t:Math.floor(t)===t?t.toString():Math.abs(t)>1e3?t.toFixed(0):Math.abs(t)>100?t.toFixed(1):t.toFixed(2)}async function handleChange(t){console.log("Sending change:",t),await sendCommand("update","POST",t)}function createLabelElement(t){const e=createBaseElement("label",t);return e.innerHTML=`<div class="td_label"><span>${t.label}</span></div>`,e}function createButtonElement(t){const e=createBaseElement("button",t),a=t.glyph||"&#x1f4a1;";e.innerHTML=`<div class="td_btn" pressed="0"><span>${t.label}</span><div class="td_btn_a">${a}</div></div>`,e.pressed=Boolean(0),e.toggle=Boolean(!1);return e.getElementsByClassName("td_btn_a")[0].onclick=()=>togglePressed(e),e.setValue=function(t){this.pressed=t,this.setAttribute("pressed",this.pressed?"1":"0")},e}function createToggleElement(t){const e=createBaseElement("toggle",t),a=t.value?1:0;e.innerHTML=`<div class="td_toggle" pressed="${a}"><span>${t.label}</span><div class="td_toggle_a"><div class="td_toggle_b"></div></div></div>`,e.pressed=Boolean(a),e.toggle=!0;return e.getElementsByClassName("td_toggle_a")[0].onclick=()=>togglePressed(e),e.setValue=function(t){this.pressed=t;this.getElementsByClassName("td_toggle")[0].setAttribute("pressed",this.pressed?"1":"0")},e}function createValueElement(t){const e=createBaseElement("value",t),a=e.opts;let s;if(e.value=parseFloat(String(a.value)),e.min=a.min,e.max=a.max,e.step=a.step,s=void 0!==e.step?'<div class="td_val_b">&#9664;</div><div class="td_val_a"></div><div class="td_val_b">&#9654;</div>':'<div class="td_val_a"></div>',e.innerHTML=`<div class="td_val"><span>${a.label}</span>${s}</div>`,void 0!==e.step){const t=e.getElementsByClassName("td_val_b");t[0].onclick=()=>{e.setValue(e.value-e.step)},t[1].onclick=()=>{e.setValue(e.value+e.step)}}return e.setValue=function(t){void 0!==this.min&&t<this.min&&(t=this.min),void 0!==this.max&&t>this.max&&(t=this.max),this.value!==t&&(sendChanges(this,t),this.value=t);this.getElementsByClassName("td_val_a")[0].innerHTML=formatText(t)},e.setValue(e.value),e}function createGaugeElement(t){const e=createBaseElement("gauge",t),a=e.opts;e.value=void 0===a.value?0:a.value,e.min=void 0===a.min?0:a.min,e.max=void 0===a.max?1:a.max,e.innerHTML=`<div class="td_gauge"><span>${a.label}</span><canvas></canvas><div class="td_gauge_a">${formatText(e.value)}</div></div>`;const s=e.getElementsByTagName("canvas")[0],n=s.getContext("2d");return e.draw=function(){s.width=s.clientWidth,s.height=s.clientHeight;const t=Math.min(s.width,s.height);n.lineCap="round",n.clearRect(0,0,s.width,s.height),n.beginPath(),n.lineWidth=20,n.strokeStyle="#000",n.arc(s.width/2,s.height/2+20,t/2-24,.75*Math.PI,2.25*Math.PI),n.stroke(),n.beginPath(),n.lineWidth=16,n.strokeStyle="#09F";let e=((this.value||0)-this.min)/(this.max-this.min);e<0&&(e=0),e>1&&(e=1),n.arc(s.width/2,s.height/2+20,t/2-24,.75*Math.PI,(.75+1.5*e)*Math.PI),n.stroke()},e.setValue=function(t){this.value=t;this.getElementsByClassName("td_gauge_a")[0].innerHTML=formatText(t),this.draw()},setTimeout(()=>e.draw(),100),e.onresize=()=>e.draw(),e}function createPointerGaugeElement(t){const e=createBaseElement("pointer_gauge",t),a=e.opts;e.value=void 0===a.value?0:a.value,e.min=void 0===a.min?0:a.min,e.max=void 0===a.max?1:a.max;const s=a.colors||["#4DDB67","#D4DB4D","#DB4D4D"],n=a.ratios||[];e.innerHTML=`<div class="td_gauge"><span>${a.label}</span><canvas></canvas><div class="td_gauge_a">${formatText(e.value)}</div></div>`;const i=e.getElementsByTagName("canvas")[0],l=i.getContext("2d");return e.draw=function(){i.width=i.clientWidth,i.height=i.clientHeight;const t=Math.min(i.width,i.height);l.lineCap="square",l.clearRect(0,0,i.width,i.height),l.beginPath(),l.lineWidth=20,l.strokeStyle="#000",l.arc(i.width/2,i.height/2+20,t/2-24,.75*Math.PI,2.25*Math.PI),l.stroke();const e=Math.min(s.length,n.length>0?n.length:s.length),a=[];for(let t=0;t<e;t++)a.push(void 0!==n[t]?n[t]:1);const o=a.reduce((t,e)=>t+e,0),r=0===o?e>0?e:1:o,c=.75*Math.PI,d=2.25*Math.PI-c;let h=c;for(let n=0;n<e;n++){const e=a[n]/r*d;l.beginPath(),l.lineWidth=16,l.strokeStyle=s[n],l.arc(i.width/2,i.height/2+20,t/2-24,h,h+e),l.stroke(),h+=e}l.beginPath(),l.lineWidth=3,l.strokeStyle="#000";let g=((this.value||0)-this.min)/(this.max-this.min);g<0&&(g=0),g>1&&(g=1);const u=(.75+1.5*g)*Math.PI,m=t/2-24,p=i.width/2,v=i.height/2+20,f=p+m*Math.cos(u),y=v+m*Math.sin(u);l.moveTo(p,v),l.lineTo(f,y),l.stroke(),l.beginPath(),l.arc(p,v,5,0,2*Math.PI),l.fillStyle="#000",l.fill()},e.setValue=function(t){this.value=t;this.getElementsByClassName("td_gauge_a")[0].innerHTML=formatText(t),this.draw()},setTimeout(()=>e.draw(),100),e.onresize=()=>e.draw(),e}function createGraphElement(t){const e=createBaseElement("graph",t);e.innerHTML=`<div class="td_graph"><span>${t.label}</span><canvas></canvas></div>`;const a=e.getElementsByTagName("canvas")[0],s=a.getContext("2d");return e.setData=function(t){this.opts.data=t,this.draw()},e.draw=function(){a.width=a.clientWidth,a.height=a.clientHeight;Math.min(a.width,a.height);const t=18,e=a.height-18,n=a.width-8-t,i=e-28;let l,o,r,c;s.font="8px Sans",s.fillStyle="#000",s.fillRect(4,24,a.width-8,a.height-28);const d=this.opts;if(void 0!==this.opts.data){let h=this.opts.data&&this.opts.data.length>0&&"object"==typeof this.opts.data[0]?this.opts.data:[this.opts.data||[]];if(h.forEach(function(t){for(const e in t){const a=parseFloat(e),s=parseFloat(t[e]);(void 0===l||a<l)&&(l=a),(void 0===o||a>o)&&(o=a),(void 0===r||s<r)&&(r=s),(void 0===c||s>c)&&(c=s)}}),void 0!==l&&void 0!==o&&void 0!==r&&void 0!==c){if(d.gridy){const y=d.gridy;r=y*Math.floor(r/y),c=y*Math.ceil(c/y)}const g=o+1-l,u=c-r,m=0===g?1:g,p=0===u?1:u;function v(e){return t+n*(e-l)/m}function f(t){return e-i*(t-r)/p}if(h.forEach((t,e)=>{s.beginPath(),s.strokeStyle=h.length>1?`hsl(${360*e/h.length}, 100%, 50%)`:"#09F";let a=!0;for(const e in t){const n=parseFloat(e),i=parseFloat(t[e]);a?(s.moveTo(v(n),f(i)),a=!1):s.lineTo(v(n),f(i))}s.stroke()}),s.fillStyle="#fff",d.gridy){s.textAlign="right";for(let _=r;_<=c;_+=d.gridy){const x=f(_),E=d.ylabel?d.ylabel(_):_.toString();s.fillRect(17,x,3,1),x>s.measureText(E).width/2&&s.fillText(E,13,x+2)}}if(d.gridx){const T=d.gridx;s.textAlign="center";for(let b=T*Math.ceil(l/T);b<=o;b+=T){const w=v(b),M=d.xlabel?d.xlabel(b):b.toString();s.fillRect(w,e-1,1,3),s.fillText(M,w,e+10)}}}}else s.fillStyle="#888",s.textAlign="center",s.fillText("[No Data]",t+n/2,e-i/2);s.beginPath(),s.strokeStyle="#fff",s.moveTo(t,e-i),s.lineTo(t,e+10),s.moveTo(8,e),s.lineTo(t+n,e),s.stroke()},setTimeout(()=>e.draw(),100),e.onresize=()=>e.draw(),e}function createLogElement(t){const e=createBaseElement("log",t),a=e.opts;a.text=a.text||"",e.innerHTML=`<div class="td_log"><span>${t.label}</span><div class="td_log_a td_scrollable"></div></div>`;const s=e.getElementsByClassName("td_log_a")[0];return e.update=function(){const t=this.opts;s.innerHTML=(t.text||"").replace(/\n/g,"<br/>\n")},e.log=function(t){const e=this.opts;e.text=(e.text||"")+"\n"+t,this.update(),s.scrollTop=s.scrollHeight},e.clear=function(){this.opts.text="",this.update()},e.update(),e}function createModalElement(t){const e=createBaseElement("modal",t);return e.innerHTML=`<div class="td_modal"><span>${t.label}</span></div>`,e.onclick=()=>{togglePressed(e),e.opts.onchange||e.remove()},e}setInterval(async()=>{const t=await fetchData("data");t&&TD.update(t)},2e3);